# План изменений системы аутентификации

## 1. Аудит текущей системы аутентификации
- [x] Проведен аудит текущей системы аутентификации
- Определены все файлы, связанные с аутентификацией
- Проанализирована структура базы данных

## 2. Обновление модели пользователя
- [x] Обновлена модель пользователя для работы с телефоном вместо email
- Изменены fillable поля для поддержки новых атрибутов
- Добавлен метод для аутентификации по телефону

## 3. Изменение валидации входа
- [ ] Изменить валидацию входа (LoginRequest) для работы с телефоном
- Обновить правила валидации с email на phone
- Реализовать извлечение 10 цифр из номера телефона

## 4. Обновление контроллера аутентификации
- [ ] Обновить контроллер аутентификации (AuthenticatedSessionController)
- Изменить метод аутентификации для работы с телефоном

## 5. Обновление фронтенд компонента входа
- [ ] Обновить фронтенд компонент входа (Login.vue) для работы с телефоном
- Заменить поле email на phone
- Добавить валидацию и форматирование номера телефона

## 6. Обновление контроллера регистрации
- [ ] Обновить контроллер регистрации (RegisteredUserController) для работы с телефоном
- Изменить валидацию и создание пользователя с email на phone

## 7. Обновление фронтенд компонента регистрации
- [ ] Обновить фронтенд компонент регистрации (Register.vue) для работы с телефоном
- Заменить поле email на phone
- Добавить валидацию и форматирование номера телефона

## 8. Обновление контроллера сброса пароля
- [ ] Обновить контроллер сброса пароля (PasswordResetLinkController) для работы с телефоном
- Изменить валидацию с email на phone
- Обновить логику отправки кода сброса пароля

## 9. Обновление фронтенд компонента сброса пароля
- [ ] Обновить фронтенд компонент сброса пароля (ForgotPassword.vue) для работы с телефоном
- Заменить поле email на phone
- Добавить валидацию номера телефона

## 10. Обновление маршрутов аутентификации
- [ ] Обновить маршруты аутентификации при необходимости
- Проверить все маршруты, связанные с аутентификацией

## 11. Обновление тестов аутентификации
- [ ] Обновить тесты аутентификации для работы с телефоном
- Изменить существующие тесты для работы с номером телефона
- Добавить новые тесты для проверки валидации телефона

## 12. Реализация валидации и форматирования номера телефона
- [ ] Реализовать валидацию и форматирование номера телефона
- Создать helper функции для извлечения 10 цифр из номера
- Добавить валидацию на фронтенде и бэкенде

## 13. Обновление таблицы password_reset_tokens
- [ ] Обновить таблицу password_reset_tokens для работы с телефоном
- Добавить поле phone в таблицу
- Обновить миграцию для изменения структуры таблицы

## Технические детали

### Формат номера телефона
- Ввод: +79219245228 или 89219245228
- Хранение в БД: 9219245228 (10 цифр)
- Валидация: извлечение 10 цифр из любого формата

### Система сброса пароля
- Использовать существующую систему Laravel
- Добавить поле phone в таблицу password_reset_tokens
- Отправка кода подтверждения через SMS

### Требования к безопасности
- HTTPS
- Валидация входных данных
- Защита от брутфорса
- Логирование попыток