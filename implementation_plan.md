# Подробный план реализации системы аутентификации по номеру телефона

## 1. Изменить валидацию входа (LoginRequest) для работы с телефоном

### Файл: app/Http/Requests/Auth/LoginRequest.php

#### Изменения:
1. Заменить валидацию 'email' на 'phone'
2. Добавить метод для извлечения 10 цифр из номера телефона
3. Изменить метод authenticate() для работы с телефоном
4. Обновить метод throttleKey() для работы с телефоном

#### Новый функционал:
- Валидация номера телефона (любой формат)
- Извлечение 10 цифр из номера телефона
- Аутентификация по номеру телефона вместо email

## 2. Обновить контроллер аутентификации (AuthenticatedSessionController)

### Файл: app/Http/Controllers/Auth/AuthenticatedSessionController.php

#### Изменения:
1. Обновить метод store() для работы с номером телефона
2. Добавить логирование попыток входа
3. Добавить защиту от брутфорса

## 3. Обновить фронтенд компонент входа (Login.vue) для работы с телефоном

### Файл: resources/js/pages/auth/Login.vue

#### Изменения:
1. Заменить поле email на phone
2. Добавить валидацию номера телефона на фронтенде
3. Добавить форматирование номера телефона при вводе
4. Обновить текстовые метки

#### Новый функционал:
- Поле ввода номера телефона
- Автоматическое форматирование номера
- Валидация в реальном времени

## 4. Обновить контроллер регистрации (RegisteredUserController) для работы с телефоном

### Файл: app/Http/Controllers/Auth/RegisteredUserController.php

#### Изменения:
1. Заменить валидацию 'email' на 'phone'
2. Обновить создание пользователя с использованием phone вместо email
3. Добавить валидацию уникальности номера телефона
4. Обновить сообщения об ошибках

## 5. Обновить фронтенд компонент регистрации (Register.vue) для работы с телефоном

### Файл: resources/js/pages/auth/Register.vue

#### Изменения:
1. Заменить поле email на phone
2. Добавить валидацию номера телефона на фронтенде
3. Добавить форматирование номера телефона при вводе
4. Обновить текстовые метки

#### Новый функционал:
- Поле ввода номера телефона
- Автоматическое форматирование номера
- Валидация в реальном времени

## 6. Обновить контроллер сброса пароля (PasswordResetLinkController) для работы с телефоном

### Файл: app/Http/Controllers/Auth/PasswordResetLinkController.php

#### Изменения:
1. Заменить валидацию 'email' на 'phone'
2. Обновить логику поиска пользователя по телефону
3. Добавить отправку SMS с кодом подтверждения
4. Обновить сообщения об ошибках

## 7. Обновить фронтенд компонент сброса пароля (ForgotPassword.vue) для работы с телефоном

### Файл: resources/js/pages/auth/ForgotPassword.vue

#### Изменения:
1. Заменить поле email на phone
2. Добавить валидацию номера телефона на фронтенде
3. Добавить форматирование номера телефона при вводе
4. Обновить текстовые метки

#### Новый функционал:
- Поле ввода номера телефона
- Автоматическое форматирование номера
- Валидация в реальном времени

## 8. Обновить маршруты аутентификации при необходимости

### Файл: routes/auth.php

#### Изменения:
1. Проверить все маршруты на корректность работы с новой системой
2. Обновить middleware при необходимости

## 9. Обновить тесты аутентификации для работы с телефоном

### Файлы: 
- tests/Feature/Auth/AuthenticationTest.php
- tests/Feature/Auth/RegistrationTest.php
- tests/Feature/Auth/PasswordResetTest.php

#### Изменения:
1. Обновить тесты аутентификации для работы с номером телефона
2. Добавить тесты валидации номера телефона
3. Добавить тесты форматирования номера телефона
4. Обновить тесты сброса пароля

## 10. Реализовать валидацию и форматирование номера телефона

### Создать новые файлы:
- app/Helpers/PhoneHelper.php
- resources/js/helpers/phoneHelper.js

#### Функционал:
- Извлечение 10 цифр из номера телефона
- Валидация корректности номера
- Форматирование номера для отображения

## 11. Обновить таблицу password_reset_tokens для работы с телефоном

### Файл: database/migrations/...

#### Изменения:
1. Создать новую миграцию для изменения таблицы password_reset_tokens
2. Добавить поле phone
3. Удалить поле email
4. Обновить индексы

## Технические требования

### Валидация номера телефона:
- Поддержка форматов: +79219245228, 89219245228, 9219245228
- Извлечение 10 цифр: 9219245228
- Проверка на корректность номера

### Форматирование номера телефона:
- Автоматическое форматирование при вводе
- Отображение в формате: +7 (921) 924-52-28

### Безопасность:
- HTTPS для всех запросов
- Валидация входных данных
- Защита от брутфорса (ограничение попыток)
- Логирование всех попыток входа

### Интеграция с SMS-провайдером:
- Отправка кода подтверждения через SMS
- Обработка ошибок отправки
- Логирование отправки SMS

## Порядок реализации

1. Создать helper функции для работы с номером телефона
2. Обновить модель пользователя (уже выполнено)
3. Обновить валидацию входа (LoginRequest)
4. Обновить контроллер аутентификации
5. Обновить фронтенд компонент входа
6. Обновить контроллер регистрации
7. Обновить фронтенд компонент регистрации
8. Обновить таблицу password_reset_tokens
9. Обновить контроллер сброса пароля
10. Обновить фронтенд компонент сброса пароля
11. Обновить маршруты при необходимости
12. Обновить тесты
13. Тестирование всей системы